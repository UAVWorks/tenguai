// ********************************************************************************************************************
// *                                                                                                                  *
// *                                              Throttle control channel.                                           *
// * ---------------------------------------------------------------------------------------------------------------- *
// *                                            Канал управления ручкой газа.                                         *
// *                                                                                                                  *
// * Eugene G. Sysoletin <e.g.sysoletin@gmail.com>                                       Created 06 may 2017 at 15:34 *
// ********************************************************************************************************************

#include "XChThrottle.h"

// ********************************************************************************************************************
// *                                                                                                                  *
// *                                                   The constructor                                                *
// *                                                                                                                  *
// ********************************************************************************************************************

tengu::XChThrottle::XChThrottle()
    : tengu::XPlaneChannel ( "Throttle", "sim/flightmodel/engine/ENGN_thro_use", 0, 100  )
{
    
}

// ********************************************************************************************************************
// *                                                                                                                  *
// *                                                 Set integer value.                                               *
// * ---------------------------------------------------------------------------------------------------------------- *
// *                                           Установить целочисленное значение.                                     *
// *                                                                                                                  *
// ********************************************************************************************************************

void tengu::XChThrottle::set ( int value ) {
    this->set( ( float ) value );
}


// ********************************************************************************************************************
// *                                                                                                                  *
// *                                                   Set float value                                                *
// * ---------------------------------------------------------------------------------------------------------------- *
// *                                           Установка вещественного значения                                       *
// *                                                                                                                  *
// ********************************************************************************************************************

void tengu::XChThrottle::set ( float value ) {
    
    if ( _dataref ) {
        
        float aValue = applyRestrictions( value );
        
        float thro[ XPLANE_ENGINES_COUNT ];
        memset( &thro, 0, sizeof( float ) * XPLANE_ENGINES_COUNT );
        
        for ( int i=0; i<XPLANE_ENGINES_COUNT; i++ ) {
            
            // X-Plane value is 0 ... 1.0
            // Значение в X-Plane - 0 ... 1.0
            
            thro[i] = ( aValue / 100.0 );
        }
        
        xplugin__log( QString("XChThrottle, set value=") + QString::number( aValue ) );
        XPLMSetDatavf( _dataref, &thro[0], 0, XPLANE_ENGINES_COUNT );
    }

}

// ********************************************************************************************************************
// *                                                                                                                  *
// *                                                The destructor.                                                   *
// * ---------------------------------------------------------------------------------------------------------------- *
// *                                                  Деструктор.                                                     *
// *                                                                                                                  *
// ********************************************************************************************************************

tengu::XChThrottle::~XChThrottle() {

}


